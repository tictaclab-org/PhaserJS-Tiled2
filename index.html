<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>PhaserJS #10</title>
  <link rel="shortcut icon" type="image/png" href="images/ico_full.png" />
  <link rel="stylesheet" href="stylesheet/prism.css">
  <link rel="stylesheet" href="stylesheet/style.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
    integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <style>
    img {
      margin: auto;
      display: block;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>

  <!-- Introduction -->
  <div class="banner"
    style="display: block !important; background-image: linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)), url('https://d2skuhm0vrry40.cloudfront.net/2018/articles/2018-08-29-13-52/nintendo-takes-down-11-year-old-pokemon-fangame-kit-1535547168922.jpg/EG11/thumbnail/750x422/format/jpg/quality/60');">
    <div class="container text-center">
      <div class="main">
        <img src="images/logo.png" alt="">
        <div class="class-title text-center">
          <h1>PhaserJS<br> Fiche 10</h1>
        </div>
      </div>
      <p>Pour ce module, on se concentre sur la création de jeux vidéos dans le language JavaScript et la librarie <b>Phaser</b>.</p>
    </div>
  </div>

  <div class="container" id="challenge">

    <div class="accordion" id="accordionexemple">

      <!-- Étape 1 -->
      <div class="card">
        <div class="card-header" id="heading1">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse1"
              aria-expanded="false" aria-controls="collapse1">
              Étape 1 - Défis à compléter avant
            </button>
          </h2>
        </div>
        <div id="collapse1" class="collapse show" aria-labelledby="heading1" data-parent="#accordionexemple">
          <div class="card-body">
            <p>Avant d'entamer ce défi, assure-toi d'avoir déjà fait ceux-ci:</p>
            <ul>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-Introduction/">PhaserJS - Personnage</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-Platforms/">PhaserJS - Plateformes</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-GagnerPerdre/">PhaserJS - Gagner et Perdre</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-MapFacile/">PhaserJS - Map Facile</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-PointsEtVies/">PhaserJS - Points et Vies</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-CoeursEtEnnemis/">PhaserJS - Coeurs et Ennemis</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-Animations/">PhaserJS - Animations</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-Sons/">PhaserJS - Sons</a></li>
              <li><a href="https://tictaclab-org.github.io/PhaserJS-Tiled/">PhaserJS - Tiled</a></li>
            </ul>
            <p>Aussi, assure-toi que tu sois bien connecté.e à ton compte <a href="https://repl.it">Repl.It</a>, et que tu
              aies ton projet de la fois passée.</p>
          </div>
        </div>
      </div>

      <!-- Étape 2 -->
      <div class="card">
        <div class="card-header" id="heading2">
          <h2 class="mb-0">
            <button class="btn btn-link task" type="button" data-toggle="collapse" data-target="#collapse2"
              aria-expanded="false" aria-controls="collapse2">
              Étape 2 - Objets
            </button>
          </h2>
        </div>
        <div id="collapse2" class="collapse" aria-labelledby="heading2" data-parent="#accordionexemple">
          <div class="card-body">
            <p>On va maitenant ajouter des piques et des pièces dans notre jeu. Note que tu auras besoin des
              connaissances des fiches précédentes, dans lesquelles tu as codé le fonctionnement des objets qu'on compte
              ajouter. Tiled va uniquement nous aider à générer les objets plus simplement, mais ne va pas affecter leur
              utilité.</p>

            <p>On retourne dans Tiled afin de créer d'autres calques. On ne va pas créer des calques de "tiles" (tuiles) cette
              fois, mais un calque d'<b>objets</b>. Ceci s'appelle un "object layer". Tu peux nommer le calque "coin" pour des
              pièces (par example).</p>

            <img src="images/object_layer.png" alt="" width="25%">

            <p>On doit maintenant ajouter des objets dans ce calque. Le fonctionnement diffère par rapport aux calques
              d'avant, vu qu'on ne peut pas ajouter de tuiles dans ce calque. On doit ajouter des points, et plus tard
              dans notre code on devra indiquer à quoi correspondent ces points.</p>

            <p>Appuie sur la touche "R" sur ton clavier pour ajouter des points dans ta map. Ceci ne fonctionne que si
              tu as bien séléctionné le calque d'objets. Alternativement, tu peux choisir "Insert Rectangle" dans la
              barre de séléction.</p>

            <img src="images/R.png" alt="" width="50%">

            <p>Maintenant tu peux placer tes objets où tu les veux. Note que tous les objets dans un même calque seront
              identiques.</p>

            <p>Les objets seront simplement des petits rectangles sur ta map. Cela ressemblera plus ou moins à l'image
              suivante:</p>

            <img src="images/with_objs.png" alt="" width="50%">

            <p>On va maintenant importer ces pièces dans notre jeu Phaser. Exporte le document entier (File > Export
              As), sous format json. Sur Replit, efface l'ancien document json, et importe-le nouveau. Tu dois également
              importer l'image de ta pièce, seule. Normalement, lorsque tu as téléchargé le tileset entier dans la fiche
              passée, tu as également téléchargé chaque tile séparemment. Pas besoin de toutes les importer, la pièce
              suffira pour le moment.</p>

            <p>Dans la fonction <code>preload</code>, on doit charger la pièce, en plus du tileset qui est déjà chargé.
              Rappelle-toi que cela peut être fait de la manière suivante.</p>

            <pre><code class="language-js">
                this.load.image("img_coin", "assets/tile_50.png");
              </code></pre>

            <p>Ensuite, toujours dans <code>create</code>, après avoir chargé les plateformes, on va créer les pièces.
              On commence par créer un groupe d'objets statiques, comme d'habitude, grâce à la méthode
              <code>this.physics.add.staticGroup()</code>. Ensuite, pour chaque objet dans notre calque "coins", on
              crée une pièce. Cela se résume au code suivant:
            </p>

            <pre><code class="language-js">
                this.coins = this.physics.add.staticGroup();
                this.map.getObjectLayer('coins')['objects'].forEach(object => {
                  let obj = this.coins.create(object.x, object.y, "img_coin");
                  obj.setOrigin(0);
                });
              </code></pre>

            <p>Voici ce que fait le code:

            <ul>
              <li><code>this.map.getObjectLayer('coins')['objects']</code> représente l'entièreté des objets dans le
                calque "coins".</li>
              <li><code>forEach</code> va appliquer une même fonction à tous les objets.</li>
              <li><code>let obj = this.coins.create(object.x, object.y, "img_coin");</code> va créer un objet dans le
                groupe <code>this.coins</code>, qui s'appelle <code>obj</code>.</li>
              <li><code>obj.setOrigin(0);</code> va centrer l'objet créé afin que le centre de l'objet s'aligne avec
                l'endroit où il devrait être posé.</li>
            </ul>
            </p>

            <p>Si tu as tout fait correctement, tu devrais voir les pièces apparaître dans ton jeu! Tu peux maintenant
              retourner à la Fiche 3 pour voir comment coder l'interaction entre les pièces et le joueur. Rappelle-toi
              que cela se fait grâce au code suivant.</p>

            <pre><code class="language-js">
              this.physics.add.overlap(this.player, this.coin, function(player, coin) {
                // Ce qu'on fait lorsqu'on touche la pièce
              }, null, this);
            </code></pre>

            <p>Comme indiqué au début, le code d'interaction ne change pas, uniquement la manière de générer les pièces. Tu
              peux donc copier-coller ce que tu avais déjà! Pratique non?</p>

            <p><b>À toi de jouer!</b> Suis les mêmes étapes afin d'ajouter des piques à ton jeu. Tu vas devoir créer un
              autre calque d'objets, importer une autre image, et créer un nouveau groupe d'objets dans ton code. Ensuite,
              tu peux recycler ton code d'avant.</p>
          </div>
        </div>
      </div>

      <!-- Étape 4 -->
      <div class="card">
        <div class="card-header" id="heading4">
          <h2 class="mb-0">
            <button class="btn btn-link task" type="button" data-toggle="collapse" data-target="#collapse4"
              aria-expanded="false" aria-controls="collapse4">
              Étape 3 - Remplissage automatique
            </button>
          </h2>
        </div>
        <div id="collapse4" class="collapse" aria-labelledby="heading4" data-parent="#accordionexemple">
          <div class="card-body">
            <p>Tu as sans doute noté que Tiled nous aide à créer des maps bien plus simplement, et qu'on peut créer des maps
              bien plus complexes sans trop d'effort. Avant de continuer, on va explorer un outil très pratique qui va
              nous aider à générer nos maps plus simplement.</p>

            <p>On peut facilement remplir un grand rectangle avec une même tuile. Place-toi sur un calque de
              tuiles (comme les plateformes ou l'arrière-plan), et séléctionne une tuile à placer. Appuies sur la touche
              "P", ou sélectionne l'outil "Shape Fill Tool", et glisse simplement sur le rectangle à remplir.</p>

            <img src="images/P.png" alt="" width="50%">

            <p>N'hésite pas à explorer d'autres fonctionnalités dans Tiled!</p>
            <!-- </div> -->
          </div>
        </div>
      </div>

      <!-- Étape 5 -->
      <div class="card">
        <div class="card-header" id="heading5">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse5"
              aria-expanded="false" aria-controls="collapse5">
              Étape 4 - Plusieurs niveaux
            </button>
          </h2>
        </div>
        <div id="collapse5" class="collapse" aria-labelledby="heading5" data-parent="#accordionexemple">
          <div class="card-body">
            <p>On va maintenant créer plusieurs niveaux au sein de notre jeu. Dans Phaser, cela s'appelle des "scènes".
            </p>

            <p>Pour ce faire, on va devoir restructurer notre code un peu. Tout d'abord, crée un document dans ton code sur ReplIt qui s'appelle "level1.js". Tu l'auras deviné, ceci contiendra ton code pour le premier niveau.</p>

            <p>Ce code sera plus ou moins identique à ce que nous avons pour l'instant, mais pas entièrement. Bouge les fonctions <code>preload()</code>, <code>create()</code> et <code>update()</code> dans ce nouveau fichier et copie la nouvelle en-tête au début du fichier. Note que les variables <code>config</code> et <code>game</code> doivent rester dans ton fichier "script.js".</p>

            <pre><code class="language-js">
              var Level1 = new Phaser.Class({
                Extends: Phaser.Scene,
                initialize: function() {
                    Phaser.Scene.call(this, { "key": "level1" });
                },
                preload,
                create,
                update
              });

              function preload() {
                // Contenu de preload
              }

              function create() {
                // Contenu de create
              }

              function update() {
                // Contenu de update
              }
            </code></pre>

            <p>Notre premier niveau, qui pour l'instant représente le jeu entier, est donc dans un nouveau fichier. Il est important d'indiquer qu'on a créé ce nouveau fichier et de l'importer dans le jeu. Pour ce faire, rends-toi sur le fichier "index.html", et rajoute une nouvelle balise <code>script</code>, comme indiqué dans le code suivant.</p>

            <img src="images/html.png" alt="" width="50%">

            <p>C'est important que le "level1.js" soit importé <b>avant</b> le "script.js", vu qu'on va se servir du
              premier dans le second.</p>

            <p>Afin de faire en sorte que le code fonctionne à nouveau, on doit simplement indiquer, dans "script.js", que le jeu commence avec le premier niveau. Tu peux effacer les fonctions <code>preload()</code>, <code>create()</code> et <code>update()</code> du fichier, comme on les a déjà dans "level1.js". Ton document "script.js" ne devrait que contenir les lignes suivantes:
            </p>

            <pre><code class="language-js">
              var config = {
                type: Phaser.AUTO,
                width: 1000,
                height: 640,
                physics: {
                  default: 'arcade'
                },
                scene: [Level1]
              };

              const game = new Phaser.Game(config);
            </code></pre>

            <p>Note bien les changements par rapport à la variable <code>config</code> d'avant. Il n'y a plus de
              fonctions <code>preload()</code>, <code>create()</code> et <code>update()</code>, mais il y a uniquement des noms de scènes. Pour l'instant il n'y a qu'une scène, mais tu peux imaginer où iront les autres scènes.
            </p>

            <p><b>À toi de jouer!</b> Tu peux maintenant créer ton second niveau. Voici les étapes à suivre:
            <ul>
              <li>Tout d'abord, dans Tiled, crée un nouveau document. Tu dois à nouveau importer ton tileset (format
                image), créer les calques de tiles "arrière plan" et "plateformes", les calques d'objets pour les
                pièces, les piques et l'objet de changement de niveau, et tu dois ajouter la propriété "solide". Une fois ton
                second niveau prêt, tu peux l'exporter sous format json comme "level2.json".</li>
              <li>Ensuite tu dois créer un nouveau document "level2.js" dans ReplIt, et l'importer dans ton code dans le
                document "index.html". N'oublie pas que cet import doit être avant l'import du fichier "script.js".
              </li>
              <li>Tu peux maintenant copier-coller le contenu de "level1.js", et changer le niveau en fonction. Il faudra sûrement adapter au moins les noms des fichiers (le "tileset.json"). Il faut aussi changer le nom de la scène (toute première ligne), ainsi que la clé ("key") de la scène (ligne 5).</li>
              <li>Dans ton code principal ("script.js"), tu peux ajouter <code>Level2</code> à la liste de scènes, comme
                suit:
                <pre><code class="language-js">
                var config = {
                  type: Phaser.AUTO,
                  width: 1000,
                  height: 640,
                  physics: {
                    default: 'arcade'
                  },
                  scene: [Level1, Level2]
                };
              </code></pre>
              </li>
              <li>Finalement, tu dois ajouter une fonctionnalité pour un passage du premier niveau au second.
                Rappelle-toi qu'on veut changer de niveau lorsqu'on touche un objet spécifique, dans le groupe
                <code>this.level_changer</code> (tu l'as peut-être nommé différemment). Ainsi, on veut remplir le code
                suivant:
                <pre><code class="language-js">
                this.physics.add.overlap(this.player, this.level_changer, function(player, coin) {
                  // ON VEUT REMPLIR CECI
                }, null, this);
              </code></pre>
                Heureusement, il existe une manière très simple de changer de scènes. Il suffit d'utiliser la fonction
                <code>this.scene.switch('level2');</code>.
              </li>
            </ul>
            </p>
          </div>
        </div>
      </div>

      <!-- Étape 6 -->
      <!-- <div class="card">
        <div class="card-header" id="heading6">
          <h2 class="mb-0">
            <button class="btn btn-link done task" type="button" data-toggle="collapse" data-target="#collapse6"
              aria-expanded="false" aria-controls="collapse6">
              Étape 5 - Trop de copier-coller?
            </button>
          </h2>
        </div>
        <div id="collapse6" class="collapse" aria-labelledby="heading6" data-parent="#accordionexemple">
          <div class="card-body">
            <p>Le code dans "level1.js" et dans "level2.js" est pratiquement identique. La seule différence est quel
              tileset utiliser. Si tu es comme moi, tu n'as pas envie d'avoir 100 lignes de codes pratiquement
              identiques, qui ne différent qu'à une seule ligne. Imagine que tu rends ton jeu plus complexe et ajoute
              une fonctionalité. Si tu as 5 niveaux, tu dois aller ajouter ce même code 5 fois afin d'avoir cette
              fonctionalité dans les 5 nvieaux. Horrible!</p>

            <p>On va plutôt créer une fonction qui peut généraliser toutes ces fonctions. Crée un nouveau document
              JavaScript, "fonctions.js", et importe le dans "index.html", <b>avant</b> tous tes niveaux. On va créer la
              structure générale dans ce fichier. Par structure générale on entend les fonctions <code>create()</code>
              et <code>update()</code>, comme elles ne changent pas à priori. La fonction <code>preload()</code> est
              différente par niveau, et peut donc rester différente par niveau.</p>

            <p>Dans le document "fonctions.js", copies-colles tes fonctions <code>create()</code> et
              <code>update()</code>. Tu peux maintenant les effacer de tes autres codes.</p>
          </div>
        </div>
      </div> -->


    </div>
  </div>



  <div class="footer">
    <div class="footer-links">
      <a href="https://tictaclab.org/"><i class="fas fa-globe"></i></i></a>
      <a href="https://www.instagram.com/tictaclabbxl/"><i class="fab fa-instagram"></i></a>
      <a href="https://www.facebook.com/TicTacLabBXL/"><i class="fab fa-facebook"></i></a>
      <a href="https://www.linkedin.com/company/tictaclab/"><i class="fab fa-linkedin"></i></a>
      <a href="https://tictaclab-org.github.io/Fiches/"><i class="fa fa-list"></i> Fiches</a>
    </div>
    <div class="footer-copyright">
      <a href="https://tictaclab.org" rel="noopener noreferrer" target="_blank" class="alert-link copyright">
        <i class="far fa-copyright"></i> 2023 Tic Tac Lab ASBL. All rights reserved.
      </a>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <script src="javascript/prism.js"></script>
</body>

</html>
